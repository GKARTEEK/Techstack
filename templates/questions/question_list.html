{% extends 'base.html' %}

{% block title %}Interview Questions - TechStack{% endblock %}

{% block content %}
<div class="bg-white">
    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <div class="text-center">
            <h1 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                Interview Questions
            </h1>
            <p class="mt-3 max-w-2xl mx-auto text-xl text-gray-500 sm:mt-4">
                Browse and filter interview questions across different programming languages.
            </p>
        </div>

        <!-- Filters -->
        <div class="mt-8 bg-gray-50 p-6 rounded-lg shadow-sm">
            <form method="get" action="{% url 'question_list' %}" class="space-y-4 sm:space-y-0 sm:flex sm:items-end sm:space-x-4">
                <div class="w-full sm:w-1/4">
                    <label for="id_difficulty" class="block text-sm font-medium text-gray-700">Difficulty</label>
                    {{ filter_form.difficulty }}
                </div>
                <div class="w-full sm:w-1/4">
                    <label for="id_category" class="block text-sm font-medium text-gray-700">Category</label>
                    {{ filter_form.category }}
                </div>
                <div class="w-full sm:w-1/4">
                    <label for="id_language" class="block text-sm font-medium text-gray-700">Language</label>
                    {{ filter_form.language }}
                </div>
                <div class="w-full sm:w-1/4">
                    <button type="submit" class="w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                        Apply Filters
                    </button>
                </div>
            </form>
        </div>

        <!-- Questions List -->
        <div class="mt-8 space-y-6">
            {% for question in page_obj %}
                <div class="bg-white shadow overflow-hidden sm:rounded-lg border border-gray-200 question-card">
                    <div class="px-4 py-5 sm:px-6">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">
                                <a href="{% url 'question_detail' question.slug %}" class="hover:text-primary-600">
                                    {{ question.title }}
                                </a>
                            </h3>
                            <span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium 
                                {% if question.difficulty == 'easy' %}
                                    bg-green-100 text-green-800
                                {% elif question.difficulty == 'medium' %}
                                    bg-yellow-100 text-yellow-800
                                {% else %}
                                    bg-red-100 text-red-800
                                {% endif %}
                            ">
                                {{ question.get_difficulty_display }}
                            </span>
                        </div>
                        <div class="mt-1 flex flex-col sm:flex-row sm:flex-wrap sm:mt-0 sm:space-x-6">
                            <div class="mt-2 flex items-center text-sm text-gray-500">
                                <i class="fas fa-code flex-shrink-0 mr-1.5 text-gray-400"></i>
                                {{ question.language.name }}
                            </div>
                            <div class="mt-2 flex items-center text-sm text-gray-500">
                                <i class="fas fa-folder flex-shrink-0 mr-1.5 text-gray-400"></i>
                                {{ question.category.name }}
                            </div>
                            <div class="mt-2 flex items-center text-sm text-gray-500">
                                <i class="fas fa-calendar flex-shrink-0 mr-1.5 text-gray-400"></i>
                                {{ question.created_at|date:"F d, Y" }}
                            </div>
                        </div>
                    </div>
                    <div class="border-t border-gray-200 px-4 py-5 sm:px-6">
                        <p class="text-gray-700">{{ question.content|truncatewords:50 }}</p>
                        <div class="mt-4 flex justify-between">
                            <a href="{% url 'question_detail' question.slug %}" class="text-primary-600 hover:text-primary-700">
                                Read more <span aria-hidden="true">&rarr;</span>
                            </a>
                            <div class="flex items-center text-gray-500">
                                <i class="far fa-bookmark mr-1"></i>
                                <span>{{ question.bookmarks.count }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            {% empty %}
                <div class="text-center py-12 bg-white rounded-lg shadow">
                    <i class="fas fa-search text-4xl text-gray-300"></i>
                    <h3 class="mt-2 text-lg font-medium text-gray-900">No questions found</h3>
                    <p class="mt-1 text-sm text-gray-500">Try adjusting your search or filter criteria.</p>
                </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
            <div class="mt-8 flex justify-center">
                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                    {% if page_obj.has_previous %}
                        <a href="?page={{ page_obj.previous_page_number }}" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Previous</span>
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    {% else %}
                        <span class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400 cursor-not-allowed">
                            <span class="sr-only">Previous</span>
                            <i class="fas fa-chevron-left"></i>
                        </span>
                    {% endif %}
                    
                    {% for i in page_obj.paginator.page_range %}
                        {% if page_obj.number == i %}
                            <span class="relative inline-flex items-center px-4 py-2 border border-primary-500 bg-primary-50 text-sm font-medium text-primary-600">
                                {{ i }}
                            </span>
                        {% else %}
                            <a href="?page={{ i }}" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                                {{ i }}
                            </a>
                        {% endif %}
                    {% endfor %}
                    
                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Next</span>
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    {% else %}
                        <span class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400 cursor-not-allowed">
                            <span class="sr-only">Next</span>
                            <i class="fas fa-chevron-right"></i>
                        </span>
                    {% endif %}
                </nav>
            </div>
        {% endif %}

        <!-- Submit Question CTA -->
        <div class="mt-12 bg-primary-50 rounded-lg shadow-sm p-8 text-center">
            <h2 class="text-2xl font-bold text-primary-800">Have a question to share?</h2>
            <p class="mt-2 text-primary-600">Help the community by submitting interview questions you've encountered.</p>
            <div class="mt-6">
                {% if user.is_authenticated %}
                    <a href="{% url 'submit_question' %}" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                        Submit a Question
                    </a>
                {% else %}
                    <a href="{% url 'account_login' %}" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                        Login to Submit
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
    /* Card hover effect */
    .question-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        opacity: 0;
        animation: fadeIn 0.5s ease-out forwards;
    }
    
    .question-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    /* Animation for cards */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Style form elements */
    select {
        width: 100%;
        padding: 0.5rem;
        border-radius: 0.375rem;
        border-color: #d1d5db;
        background-color: white;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    }
    
    select:focus {
        outline: none;
        border-color: #0ea5e9;
        box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Stagger animation of question cards
        const cards = document.querySelectorAll('.question-card');
        cards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });
        
        // Preserve filter parameters in pagination links
        const paginationLinks = document.querySelectorAll('nav a');
        const currentUrl = new URL(window.location.href);
        const searchParams = new URLSearchParams(currentUrl.search);
        
        paginationLinks.forEach(link => {
            const linkUrl = new URL(link.href);
            const pageParam = new URLSearchParams(linkUrl.search).get('page');
            
            if (pageParam) {
                // Copy all existing parameters except 'page'
                searchParams.forEach((value, key) => {
                    if (key !== 'page') {
                        linkUrl.searchParams.set(key, value);
                    }
                });
                
                link.href = linkUrl.toString();
            }
        });
    });
</script>
{% endblock %}
